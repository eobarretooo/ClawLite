<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ClawLite Dashboard Premium</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configurando Tailwind com paleta premium Dark Mode -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        fox: {
                            50: '#fff3ec',
                            100: '#ffe4d3',
                            500: '#ff6b2b',
                            600: '#ea4f0d',
                            700: '#c2380a',
                            900: '#7e260b',
                        },
                        drk: {
                            900: '#0b1020', // bg ultra escuro (sidebar)
                            800: '#111934', // paineis
                            700: '#1c284d', // bordas
                            600: '#2a3b6e', // hovers
                            300: '#9fb3de', // texto muted
                            100: '#eaf1ff', // texto principal
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Menlo', 'monospace'],
                    }
                }
            }
        }
    </script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel para compilar JSX in-browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body {
            background-color: #0b1020;
            color: #eaf1ff;
            background-image: radial-gradient(circle at top left, #173366 0%, #0b1020 40%);
            background-attachment: fixed;
        }
        
        /* Custom Scrollbar Premium */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #2a3b6e; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #ff6b2b; }

        /* Loader Animation */
        .loader {
            border: 3px solid rgba(255, 107, 43, 0.2);
            border-bottom-color: #ff6b2b;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased selection:bg-fox-500 selection:text-white overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        // --- Utils e Context API Globais ---
        const { useState, useEffect, useRef, useMemo, createContext, useContext } = React;
        
        // Criando contexto global de AppState para nÃ£o passar props eternamente
        const AppContext = createContext();

        // Config de Tabs que espelha os Ã­cones da Lucide com a label
        const TABS = [
            { id: 'chat', label: 'Chat', icon: 'message-square' },
            { id: 'sessions', label: 'Sessions', icon: 'server' },
            { id: 'cron', label: 'Cron Jobs', icon: 'clock' },
            { id: 'channels', label: 'Channels', icon: 'satellite-dish' },
            { id: 'config', label: 'System Config', icon: 'settings' },
            { id: 'workspace', label: 'Workspace', icon: 'folder-code' },
            { id: 'skills', label: 'Skills Hub', icon: 'blocks' },
            { id: 'telemetry', label: 'Telemetria', icon: 'bar-chart-3' },
            { id: 'logs', label: 'Realtime Logs', icon: 'terminal' }
        ];

        // Componente utilitÃ¡rio de Card
        const Card = ({ children, className = "" }) => (
            <div className={`bg-gradient-to-b from-drk-800 to-drk-900 border border-drk-700 rounded-xl p-4 shadow-xl ${className}`}>
                {children}
            </div>
        );

        // Componente Ãcone
        const Icon = ({ name, size = 18, className = "" }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (ref.current && window.lucide) {
                    lucide.createIcons({
                        icons: { [name.replace(/-/g, '')]: window.lucide.icons[name.replace(/-(.)/g, (_, c) => c.toUpperCase())] } || window.lucide.icons,
                        nameAttr: 'data-lucide',
                        root: ref.current.parentNode
                    });
                }
            }, [name]);
            return <i ref={ref} data-lucide={name} style={{ width: size, height: size }} className={className} />;
        };

        // --- Sidebar (Painel de Status e Menu) ---
        const Sidebar = () => {
            const { 
                tab, setTab, 
                token, setToken, 
                status, isConnected, doLogin 
            } = useContext(AppContext);
            
            const handleTokenChange = (e) => setToken(e.target.value);

            return (
                <aside className="w-72 flex-shrink-0 border-r border-drk-700 bg-drk-900/50 backdrop-blur top-0 h-screen flex flex-col p-4 overflow-y-auto">
                    {/* Header Logo */}
                    <div className="flex items-center gap-3 mb-6 mix-blend-screen">
                        <div className="bg-fox-500/10 p-2 rounded-lg border border-fox-500/30">
                            <span className="text-2xl" role="img" aria-label="fox">ðŸ¦Š</span>
                        </div>
                        <div>
                            <h1 className="font-bold tracking-tight text-white text-lg">ClawLite</h1>
                            <p className="text-xs text-drk-300 font-mono tracking-wider">PREMIUM ENGINE</p>
                        </div>
                    </div>

                    {/* Authentication Card */}
                    <Card className="mb-4">
                        <h2 className="text-xs font-bold text-drk-300 uppercase tracking-wider mb-2 flex items-center gap-2">
                            <Icon name="key" size={14}/> Node Authentication
                        </h2>
                        {!isConnected ? (
                            <div className="space-y-2">
                                <input 
                                    type="password" 
                                    value={token} 
                                    onChange={handleTokenChange}
                                    placeholder="Insert Bearer Token" 
                                    className="w-full bg-drk-900 border border-drk-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-fox-500 focus:ring-1 focus:ring-fox-500"
                                />
                                <button 
                                    onClick={doLogin}
                                    className="w-full bg-fox-600 hover:bg-fox-500 text-white font-medium rounded-lg px-3 py-2 text-sm transition-colors shadow-lg shadow-fox-500/20"
                                >
                                    Connect to Gateway
                                </button>
                            </div>
                        ) : (
                            <div className="flex items-center justify-between bg-drk-900 border border-drk-700 rounded-lg p-2">
                                <div className="flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
                                    <span className="text-sm font-mono text-drk-100">â€¢â€¢â€¢â€¢{token.slice(-4)}</span>
                                </div>
                                <button onClick={() => setToken('')} className="text-xs text-drk-300 hover:text-red-400">Disconnect</button>
                            </div>
                        )}
                    </Card>

                    {/* Status Dashboard Mini (Only if connected) */}
                    {isConnected && (
                        <div className="mb-6 space-y-3 pl-1">
                            <div className="flex justify-between items-center text-sm">
                                <span className="text-drk-300 flex items-center gap-2">
                                    <Icon name="activity" size={14}/> Core Status
                                </span>
                                <span className={status?.online ? "text-green-400 font-medium" : "text-red-400 font-medium"}>
                                    {status?.online ? 'Online' : 'Offline'}
                                </span>
                            </div>
                            <div className="flex justify-between items-center text-sm">
                                <span className="text-drk-300 flex items-center gap-2">
                                    <Icon name="cpu" size={14}/> Model
                                </span>
                                <span className="text-fox-500 font-mono text-xs">{status?.model || 'â€”'}</span>
                            </div>
                            <div className="flex justify-between items-center text-sm">
                                <span className="text-drk-300 flex items-center gap-2">
                                    <Icon name="clock" size={14}/> Uptime
                                </span>
                                <span className="text-drk-100 font-mono text-xs">{status?.uptime_seconds ? `${Math.floor(status.uptime_seconds/3600)}h ${Math.floor((status.uptime_seconds%3600)/60)}m` : 'â€”'}</span>
                            </div>
                        </div>
                    )}

                    <div className="mt-2 text-xs font-bold text-drk-300 uppercase tracking-wider mb-2 pl-2">Navigation</div>
                    
                    {/* Navigation Menu (Tabs) */}
                    <nav className="flex-1 space-y-1">
                        {TABS.map(item => (
                            <button
                                key={item.id}
                                onClick={() => setTab(item.id)}
                                className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all ${
                                    tab === item.id 
                                        ? 'bg-fox-500/10 text-fox-500 border border-fox-500/30 shadow-[inset_0_0_15px_rgba(255,107,43,0.1)]' 
                                        : 'text-drk-300 hover:bg-drk-800 hover:text-drk-100 border border-transparent'
                                }`}
                            >
                                <Icon name={item.icon} size={16} />
                                {item.label}
                            </button>
                        ))}
                    </nav>
                </aside>
            )
        };

        // --- Screens Mocks (Sprints 5 implementations will expand this) ---
        const ConstructionScreen = ({ title, icon }) => (
            <div className="flex-1 flex flex-col items-center justify-center h-full opacity-50">
                <Icon name={icon} size={64} className="mb-4 text-drk-600" />
                <h2 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-drk-100 to-drk-300">{title}</h2>
                <p className="text-drk-300 mt-2">Esta tela estÃ¡ sendo construÃ­da no Sprint 5. ðŸ¦Š</p>
            </div>
        );

        const ChatScreen = () => {
            return (
                <div className="flex flex-col h-full"> 
                    <div className="flex items-center justify-between pb-4 border-b border-drk-700 mb-4">
                        <h2 className="text-lg font-bold flex items-center gap-2"><Icon name="message-square"/> Console Engine</h2>
                        <span className="text-xs bg-drk-800 border border-drk-700 px-2 py-1 rounded text-drk-300 font-mono">Session: dashboard-zero</span>
                    </div>
                    
                    <div className="flex-1 overflow-y-auto bg-drk-900/50 rounded-xl border border-drk-700 p-4 mb-4">
                        <div className="text-center text-drk-300 text-sm mt-10">
                            Sem histÃ³rico ativo.<br/>Conecte-se para iniciar a transmissÃ£o SSE real-time.
                        </div>
                    </div>

                    <div className="flex gap-2">
                        <input type="text" placeholder="Envie comandos multimodais para o ClawLite..." className="flex-1 bg-drk-800 border border-drk-700 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-fox-500 focus:ring-1 focus:ring-fox-500" />
                        <button className="bg-fox-600 hover:bg-fox-500 text-white rounded-xl px-4 py-3 font-medium transition-colors shadow-lg shadow-fox-500/20 flex items-center gap-2">
                            <Icon name="send" size={16} /> Send
                        </button>
                    </div>
                </div>
            );
        }

        // --- Main App Orchestrator ---
        const MainApp = () => {
            const [tab, setTab] = useState('chat');
            const [token, setToken] = useState(localStorage.getItem('clawlite_token') || '');
            const [isConnected, setIsConnected] = useState(false);
            const [status, setStatus] = useState(null);

            // API Utils Proxy
            const apiCall = async (path, options = {}) => {
                const headers = { 'Content-Type': 'application/json', ...(options.headers || {}) };
                if (token) headers.Authorization = `Bearer ${token}`;
                const res = await fetch(path, { ...options, headers });
                const data = await res.json().catch(() => ({}));
                if (!res.ok) throw new Error(data.detail || `HTTP ${res.status}`);
                return data;
            };

            const doLogin = async () => {
                if(!token) return;
                try {
                    const authRes = await fetch('/api/dashboard/auth', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ token })
                    }).then(r => r.json());
                    
                    if (authRes.ok) {
                        setIsConnected(true);
                        localStorage.setItem('clawlite_token', token);
                        // Fetch initial bootsrap
                        apiCall('/api/dashboard/bootstrap').then(b => setStatus(b.status)).catch(console.error);
                    } else {
                        alert("Token InvÃ¡lido ou Gateway offline.");
                    }
                } catch(e) {
                    alert("Erro de conexÃ£o na Auth.");
                }
            };
            
            // Re-auth silently if token was in localstorage
            useEffect(() => { if(token) doLogin(); }, []);

            // Main View Switcher
            const renderMainArea = () => {
                switch(tab) {
                    case 'chat': return <ChatScreen />;
                    case 'telemetry': return <ConstructionScreen title="LLM Telemetria AvanÃ§ada" icon="bar-chart-3" />;
                    case 'skills': return <ConstructionScreen title="Skills Marketplace" icon="blocks" />;
                    case 'channels': return <ConstructionScreen title="Channels Watchtower" icon="satellite-dish" />;
                    default: return <ConstructionScreen title="Em Desenvolvimento" icon="wrench" />;
                }
            };

            return (
                <AppContext.Provider value={{ tab, setTab, token, setToken, status, isConnected, doLogin, apiCall }}>
                    <div className="flex h-screen overflow-hidden">
                        <Sidebar />
                        <main className="flex-1 p-6 relative flex flex-col h-screen overflow-hidden">
                            {/* Decorative background glow */}
                            <div className="absolute top-[-10%] left-[-10%] w-96 h-96 bg-fox-500/5 rounded-full blur-[100px] pointer-events-none"></div>
                            <div className="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-blue-500/5 rounded-full blur-[100px] pointer-events-none"></div>
                            
                            <div className="relative z-10 flex-1 flex flex-col h-full bg-drk-900/40 backdrop-blur-sm border border-drk-700/50 rounded-2xl shadow-2xl p-6">
                                {renderMainArea()}
                            </div>
                        </main>
                    </div>
                </AppContext.Provider>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MainApp />);
        
        // Manual init for lucide in non-react roots if needed
        setTimeout(() => { if(window.lucide) lucide.createIcons(); }, 100);
    </script>
</body>
</html>
